---
import Layout from '~/layouts/PageLayout.astro';
import HeroText from '~/components/widgets/HeroText.astro';
import ContactUs from '~/components/widgets/Contact.astro';
import Features2 from '~/components/widgets/Features2.astro';
import CallToAction from '~/components/widgets/CallToAction.astro';

const metadata = {
  title: 'Contact - Schedule Your Free Real Estate Consultation',
};
---

<Layout metadata={metadata}>
  <!-- Hero Section with Form -->
  <section class="px-4 py-12 sm:px-6 mx-auto lg:px-8 lg:py-16 max-w-7xl">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12 items-start">
      <!-- Left Column - Contact Form -->
      <div class="order-2 lg:order-1">
        <div class="bg-white dark:bg-slate-900 rounded-lg shadow-lg p-6 lg:p-8">
          <h2 class="text-2xl font-bold mb-2 text-slate-900 dark:text-white">Send Me a Message</h2>
          <p class="text-slate-600 dark:text-slate-400 mb-6">Fill out the form and I'll get back to you within 24 hours.</p>

          <form id="contact-form" action="https://api.web3forms.com/submit" method="POST" class="space-y-4">
            <!-- Web3Forms Access Key -->
            <input type="hidden" name="access_key" value="e182d6f8-2ca4-4c55-8b7e-27983e248e04" />
            <input type="hidden" name="redirect" value="false" />
            <input type="hidden" name="subject" value="New Contact Form Submission from Real Estate Website" />
            <input type="hidden" name="from_name" value="SinnaHomes" />

            <!-- Success Message -->
            <div id="success-message" class="hidden bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 text-green-800 dark:text-green-200 px-4 py-3 rounded-lg">
              <p class="font-semibold">Thank you for your message!</p>
              <p class="text-sm">I'll get back to you within 24 hours.</p>
            </div>

            <!-- Error Message -->
            <div id="error-message" class="hidden bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-800 dark:text-red-200 px-4 py-3 rounded-lg">
              <p class="font-semibold">Oops! Something went wrong.</p>
              <p class="text-sm">Please try again or contact me directly.</p>
            </div>

            <div>
              <label for="name" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                Full Name
              </label>
              <input
                type="text"
                id="name"
                name="name"
                required
                class="w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800 dark:text-white"
                placeholder="John Doe"
              />
            </div>

            <div>
              <label for="email" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                Email Address
              </label>
              <input
                type="email"
                id="email"
                name="email"
                required
                class="w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800 dark:text-white"
                placeholder="john@example.com"
              />
            </div>

            <div>
              <label for="phone" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                Phone Number
              </label>
              <input
                type="tel"
                id="phone"
                name="phone"
                class="w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800 dark:text-white"
                placeholder="(555) 123-4567"
              />
            </div>

            <div>
              <label for="inquiry_type" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                I am interested in
              </label>
              <select
                id="inquiry_type"
                name="inquiry_type"
                class="w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800 dark:text-white"
              >
                <option value="buying">Buying a Home</option>
                <option value="selling">Selling My Property</option>
                <option value="renting">Renting a Property</option>
                <option value="consultation">General Consultation</option>
                <option value="other">Other</option>
              </select>
            </div>

            <div>
              <label for="message" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                Your Message
              </label>
              <textarea
                id="message"
                name="message"
                rows="4"
                class="w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800 dark:text-white"
                placeholder="Tell me about your real estate needs..."
              ></textarea>
            </div>

            <button
              type="submit"
              id="submit-btn"
              class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
            >
              <span id="submit-text">Send Message</span>
              <span id="submit-loading" class="hidden">Sending...</span>
            </button>

            <p class="text-xs text-slate-500 dark:text-slate-400">
              By submitting this form, you agree to be contacted regarding your real estate inquiry. Your information will be kept confidential.
            </p>
          </form>
        </div>
      </div>

      <!-- Right Column - Text Content -->
      <div class="order-1 lg:order-2">
        <p class="text-base text-accent dark:text-blue-200 font-semibold tracking-wide uppercase mb-2">
          Contact
        </p>
        <h1 class="text-4xl md:text-5xl font-bold leading-tighter tracking-tighter mb-4 font-heading dark:text-gray-200">
          Let's Find Your Dream Home Together!
        </h1>
        <p class="text-xl text-muted dark:text-slate-300 mb-8">
          Ready to start your home search in the Greater Toronto Area? I'm here to help you every step of the way.
        </p>

        <div class="space-y-6">
          <div class="flex items-start">
            <div class="flex-shrink-0 w-12 h-12 bg-blue-100 dark:bg-blue-900 rounded-lg flex items-center justify-center mr-4">
              <svg class="w-6 h-6 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
              </svg>
            </div>
            <div>
              <h3 class="font-semibold text-slate-900 dark:text-white mb-1">Phone</h3>
              <p class="text-slate-600 dark:text-slate-400">(416) 704-2827</p>
              <p class="text-sm text-slate-500 dark:text-slate-400">Call or text anytime</p>
            </div>
          </div>

          <div class="flex items-start">
            <div class="flex-shrink-0 w-12 h-12 bg-blue-100 dark:bg-blue-900 rounded-lg flex items-center justify-center mr-4">
              <svg class="w-6 h-6 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
              </svg>
            </div>
            <div>
              <h3 class="font-semibold text-slate-900 dark:text-white mb-1">Email</h3>
              <p class="text-slate-600 dark:text-slate-400">srajasiri@gmail.com</p>
              <p class="text-sm text-slate-500 dark:text-slate-400">I respond within 24 hours</p>
            </div>
          </div>

        </div>
      </div>
    </div>
  </section>

  <script>
    let formInitialized = false;

    function initContactForm() {
      const form = document.getElementById('contact-form');
      const submitBtn = document.getElementById('submit-btn');
      const submitText = document.getElementById('submit-text');
      const submitLoading = document.getElementById('submit-loading');
      const successMessage = document.getElementById('success-message');
      const errorMessage = document.getElementById('error-message');

      if (!form || formInitialized) return;
      formInitialized = true;

      form.addEventListener('submit', async (e) => {
        e.preventDefault();

        // Show loading state
        submitBtn.disabled = true;
        submitText.classList.add('hidden');
        submitLoading.classList.remove('hidden');
        successMessage.classList.add('hidden');
        errorMessage.classList.add('hidden');

        try {
          const formData = new FormData(form);
          const response = await fetch(form.action, {
            method: 'POST',
            body: formData,
            headers: {
              'Accept': 'application/json'
            }
          });

          console.log('Response status:', response.status);
          console.log('Response ok:', response.ok);

          if (response.ok) {
            // Show success message
            successMessage.classList.remove('hidden');
            form.reset();
          } else {
            // Show error message
            const errorData = await response.json();
            console.error('Error data:', errorData);
            errorMessage.classList.remove('hidden');
          }
        } catch (error) {
          // Show error message
          console.error('Fetch error:', error);
          errorMessage.classList.remove('hidden');
        } finally {
          // Reset button state
          submitBtn.disabled = false;
          submitText.classList.remove('hidden');
          submitLoading.classList.add('hidden');
        }
      });
    }

    // Initialize on page load
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initContactForm);
    } else {
      initContactForm();
    }

    // Re-initialize for Astro view transitions
    document.addEventListener('astro:page-load', initContactForm);
  </script>

  <!-- Call to Action -->
  <CallToAction
    actions={[
      {
        variant: 'primary',
        text: 'Browse Properties',
        href: '/properties',
        icon: 'tabler:home-search',
      },
      {
        variant: 'secondary',
        text: 'Learn About My Services',
        href: '/services',
      },
    ]}
  >
    <Fragment slot="title">
      Prefer to Browse First?
    </Fragment>

    <Fragment slot="subtitle">
      Check out my current property listings or learn more about the comprehensive services I offer.
    </Fragment>
  </CallToAction>
</Layout>
