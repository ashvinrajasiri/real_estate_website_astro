---
import Layout from '~/layouts/PageLayout.astro';
import Header from '~/components/widgets/Header.astro';
import Hero3 from '~/components/widgets/Hero3.astro';
import Features from '~/components/widgets/Features.astro';
import Content from '~/components/widgets/Content.astro';
import CallToAction from '~/components/widgets/CallToAction.astro';
import Testimonials from '~/components/widgets/Testimonials.astro';
import FAQAccordion from '~/components/widgets/FAQAccordion.astro';
import PropertyCard from '~/components/common/PropertyCard.astro';
import { getAllProperties } from '~/utils/sanity';
import { getTestimonials } from '~/utils/googleReviews';
import { Image } from 'astro:assets';
import heroImage from '~/assets/images/hero-image1.png';
import { headerData } from '~/navigation';

const metadata = {
  title: 'Find Your Dream Home in the Greater Toronto Area | Rajasiri Sinnarajah',
  description: 'Five years helping first-time buyers and growing families find homes in the GTA. No pressure, just straight talk about what you can afford and where you should look.',
  ignoreTitleTemplate: true,
};

// Get all properties from Sanity
const properties = await getAllProperties();

// Get testimonials from Google Reviews
const testimonials = await getTestimonials();

// Get featured properties (first 6)
const featuredProperties = properties.slice(0, 6);
---

<Layout metadata={metadata}>
  <Header slot="header" {...headerData} isSticky showRssFeed showToggleTheme lightText />
  <!-- Hero Section -->
  <Hero3
    actions={[
      {
        variant: 'primary',
        text: 'Book a Free Consultation',
        href: '/contact',
        icon: 'tabler:calendar',
      },
    ]}
  >
    <Fragment slot="title">
      Break Into the GTA Market <br class="hidden sm:block" /><span class="text-blue-400 font-extrabold [text-shadow:_0_2px_12px_rgb(59_130_246_/_50%)]">Without Overpaying</span>
    </Fragment>

    <Fragment slot="subtitle">
      I help first-time buyers and growing families find a home within their budget in the right neighborhood.
    </Fragment>

    <Fragment slot="bg">
      <Image
        src={heroImage}
        alt="Family enjoying their new living room"
        class="w-full h-full object-cover object-center"
        widths={[400, 768, 1024, 1920, 2560]}
        sizes="100vw"
        loading="eager"
        quality={90}
      />
    </Fragment>
  </Hero3>

  <!-- What You Can Expect Section -->
  <Features
    id="services"
    tagline="What You Can Expect"
    title="How I Work"
    subtitle="No pressure, no jargon—just honest guidance through the process"
    items={[
      {
        title: 'Straight Talk About Pricing',
        description:
          'I will tell you what a place is actually worth, not what the listing says. If something is overpriced or has issues that will affect resale, you will know.',
        icon: 'tabler:chart-line',
      },
      {
        title: 'First-Timer Friendly',
        description:
          'I have been through this myself. I know what it is like to not know what you do not know. I will explain the steps, the paperwork, and what to expect—without making you feel like you should already understand it.',
        icon: 'tabler:home-heart',
      },
      {
        title: 'Timing Coordination for Sellers',
        description:
          'Families are trying to time selling and buying without ending up in their parents basement for three months. I help coordinate closings and bridge the gap so you are not stuck between homes.',
        icon: 'tabler:calendar-check',
      },
      {
        title: 'Negotiation Without the Drama',
        description:
          'I am methodical and calm. I run the numbers, present the options, and help you decide what makes sense. No pressure tactics, no rushed decisions.',
        icon: 'tabler:scale',
      },
      {
        title: 'Responsive Communication',
        description:
          'I respond quickly to texts and emails. If you have a question at 9 PM because you just saw a listing, I will get back to you.',
        icon: 'tabler:message-circle',
      },
      {
        title: 'Network of Pros',
        description:
          'I know good inspectors, mortgage brokers, and contractors who will not upsell you. I can connect you with people who will give you straight answers.',
        icon: 'tabler:users-group',
      },
    ]}
  />

  <!-- Testimonials Section -->
  <Testimonials
    title="What My Clients Say"
    subtitle="Real feedback from satisfied homebuyers and sellers"
    tagline="Testimonials"
    testimonials={testimonials}
  />

  <!-- Featured Properties Section -->
  <section class="px-4 py-16 sm:px-6 mx-auto lg:px-8 lg:py-20 max-w-7xl" id="featured">
    <div class="mb-10 md:mb-12 text-center">
      <p class="text-base text-accent dark:text-blue-200 font-semibold tracking-wide uppercase">
        Featured Listings
      </p>
      <h2 class="text-4xl md:text-5xl font-bold leading-tighter tracking-tighter mb-4 font-heading">
        Explore Our Latest Properties
      </h2>
      <p class="max-w-3xl mx-auto text-xl text-muted dark:text-slate-400">
        Handpicked properties that offer exceptional value and quality in prime locations
      </p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
      {featuredProperties.map((property) => (
        <PropertyCard property={property} />
      ))}
    </div>

    <div class="text-center mt-10">
      <a
        href="/properties"
        class="btn btn-primary inline-flex items-center justify-center px-6 py-3 text-white bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold transition-colors"
      >
        View All Properties
        <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
        </svg>
      </a>
    </div>
  </section>

  <!-- FAQ Section -->
  <FAQAccordion
    title="Common Questions"
    tagline="FAQ"
    items={[
      {
        title: 'How much do I need for a down payment?',
        description: 'For first-time buyers in the GTA, the minimum is 5% on the first $500k and 10% on anything above that. So on a $700k home, you would need $45k. If you have less than 20% down, you will need mortgage insurance (CMHC). I can walk you through what that actually costs and connect you with mortgage brokers who will give you straight numbers.',
      },
      {
        title: 'Should I wait for prices to drop?',
        description: 'Nobody has a crystal ball, but here is what I tell people: if you can afford a place now and plan to stay for at least 5 years, waiting is usually just delaying your life. Prices might drop, or they might climb while you save. What matters more is buying something you can afford that makes sense for your situation.',
      },
      {
        title: 'How long does it take to buy a home?',
        description: 'From starting to look to getting keys, most buyers take 3-6 months. That includes figuring out your budget, getting pre-approved, viewing homes, making offers, and closing. If you are ready to move quickly and the market is slow, it can be faster. If you are picky or the market is competitive, it might take longer.',
      },
      {
        title: 'What if I need to sell my current place first?',
        description: 'This is the trickiest part for families upgrading. You can make your offer conditional on selling your place, but in a competitive market that makes it harder to win. The other option is a bridge loan, where you borrow against your current home to buy the next one, then pay it back when your place sells. I help coordinate the timing either way.',
      },
      {
        title: 'Do you charge a fee?',
        description: 'For buyers: No. The buyer agent commission is paid by the seller (it is already baked into the listing price). You do not pay me anything directly. For sellers: Yes, there is a commission when your home sells (typically around 5% total, split between your agent and the buyer agent). I will walk you through exactly what that covers and how it works.',
      },
      {
        title: 'What neighborhoods should I look at?',
        description: 'That depends on your budget, commute, and what you need (schools, space, walkability). A lot of first-time buyers overlook neighborhoods that are 10 minutes farther out but $150k cheaper. I will show you what your money gets you in different areas and explain the trade-offs honestly.',
      },
    ]}
  >
    <Fragment slot="bg">
      <div class="absolute inset-0 bg-blue-50 dark:bg-transparent"></div>
    </Fragment>
  </FAQAccordion>

  <!-- Call to Action -->
  <CallToAction
    actions={[
      {
        variant: 'primary',
        text: 'Book a Free Consultation',
        href: '/contact',
        icon: 'tabler:calendar',
      },
    ]}
  >
    <Fragment slot="title">
      Ready to Get Started?
    </Fragment>

    <Fragment slot="subtitle">
      Let's talk about your situation and figure out the best next steps for you.
    </Fragment>
  </CallToAction>
</Layout>
