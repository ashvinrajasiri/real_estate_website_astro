---
// PropertyFilter component for filtering properties
// This component uses client-side JavaScript for interactive filtering
---

<div class="bg-white dark:bg-slate-900 rounded-lg shadow-lg p-6 mb-8">
  <form id="propertyFilter" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
    <!-- Type Filter -->
    <div>
      <label for="filterType" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
        Property Type
      </label>
      <select
        id="filterType"
        name="type"
        class="w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800 dark:text-white"
      >
        <option value="all">All Types</option>
        <option value="buy">For Sale</option>
        <option value="rent">For Rent</option>
      </select>
    </div>

    <!-- Category Filter -->
    <div>
      <label for="filterCategory" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
        Category
      </label>
      <select
        id="filterCategory"
        name="category"
        class="w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800 dark:text-white"
      >
        <option value="all">All Categories</option>
        <option value="house">House</option>
        <option value="apartment">Apartment</option>
        <option value="villa">Villa</option>
        <option value="office">Office</option>
        <option value="shop">Shop</option>
        <option value="warehouse">Warehouse</option>
      </select>
    </div>

    <!-- Price Range Filter -->
    <div>
      <label for="filterPrice" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
        Max Price
      </label>
      <select
        id="filterPrice"
        name="price"
        class="w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800 dark:text-white"
      >
        <option value="all">Any Price</option>
        <option value="250000">Under $250,000</option>
        <option value="500000">Under $500,000</option>
        <option value="750000">Under $750,000</option>
        <option value="1000000">Under $1,000,000</option>
        <option value="1500000">Under $1,500,000</option>
        <option value="2000000">Under $2,000,000</option>
      </select>
    </div>

    <!-- Bedrooms Filter -->
    <div>
      <label for="filterBeds" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
        Bedrooms
      </label>
      <select
        id="filterBeds"
        name="beds"
        class="w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-slate-800 dark:text-white"
      >
        <option value="all">Any</option>
        <option value="1">1+</option>
        <option value="2">2+</option>
        <option value="3">3+</option>
        <option value="4">4+</option>
        <option value="5">5+</option>
      </select>
    </div>
  </form>

  <!-- Results count -->
  <div class="mt-4 pt-4 border-t border-slate-200 dark:border-slate-700">
    <p id="resultsCount" class="text-sm text-slate-600 dark:text-slate-400">
      Showing all properties
    </p>
  </div>
</div>

<script>
  // Client-side filtering logic
  function initPropertyFilter() {
    const form = document.getElementById('propertyFilter');
    const resultsCount = document.getElementById('resultsCount');

    if (!form || !resultsCount) return;

    // Get all filter inputs
    const typeFilter = document.getElementById('filterType') as HTMLSelectElement;
    const categoryFilter = document.getElementById('filterCategory') as HTMLSelectElement;
    const priceFilter = document.getElementById('filterPrice') as HTMLSelectElement;
    const bedsFilter = document.getElementById('filterBeds') as HTMLSelectElement;

    // Function to filter properties
    function filterProperties() {
      const propertyCards = document.querySelectorAll('[data-property-card]');
      let visibleCount = 0;

      propertyCards.forEach((card) => {
        const element = card as HTMLElement;
        const type = element.dataset.propertyType;
        const category = element.dataset.propertyCategory;
        const price = parseInt(element.dataset.propertyPrice || '0');
        const beds = parseInt(element.dataset.propertyBeds || '0');

        // Check filters
        const typeMatch = typeFilter.value === 'all' || type === typeFilter.value;
        const categoryMatch = categoryFilter.value === 'all' || category === categoryFilter.value;
        const priceMatch = priceFilter.value === 'all' || price <= parseInt(priceFilter.value);
        const bedsMatch = bedsFilter.value === 'all' || beds >= parseInt(bedsFilter.value);

        // Show or hide card
        if (typeMatch && categoryMatch && priceMatch && bedsMatch) {
          element.style.display = '';
          visibleCount++;
        } else {
          element.style.display = 'none';
        }
      });

      // Update results count
      resultsCount.textContent = `Showing ${visibleCount} ${visibleCount === 1 ? 'property' : 'properties'}`;
    }

    // Add event listeners to all filters
    [typeFilter, categoryFilter, priceFilter, bedsFilter].forEach((filter) => {
      if (filter) {
        filter.addEventListener('change', filterProperties);
      }
    });

    // Check URL parameters on load
    const urlParams = new URLSearchParams(window.location.search);
    const typeParam = urlParams.get('type');
    if (typeParam && typeFilter) {
      typeFilter.value = typeParam;
      filterProperties();
    }
  }

  // Initialize on page load
  document.addEventListener('DOMContentLoaded', initPropertyFilter);

  // Re-initialize after view transitions (for Astro)
  document.addEventListener('astro:page-load', initPropertyFilter);
</script>
