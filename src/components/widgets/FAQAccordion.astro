---
import WidgetWrapper from '~/components/ui/WidgetWrapper.astro';
import Headline from '~/components/ui/Headline.astro';

interface FAQ {
  title: string;
  description: string;
}

interface Props {
  title?: string;
  subtitle?: string;
  tagline?: string;
  items?: FAQ[];
  id?: string;
  isDark?: boolean;
  classes?: Record<string, string>;
}

const {
  title = '',
  subtitle = '',
  tagline = '',
  items = [],
  id,
  isDark = false,
  classes = {},
  bg = await Astro.slots.render('bg'),
} = Astro.props;
---

<WidgetWrapper id={id} isDark={isDark} containerClass={`max-w-4xl mx-auto ${classes?.container ?? ''}`} bg={bg}>
  <Headline title={title} subtitle={subtitle} tagline={tagline} />

  <div class="space-y-4 mt-8">
    {items.map((item, index) => (
      <div class="border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden">
        <button
          type="button"
          class="faq-question w-full px-6 py-4 text-left flex justify-between items-center hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors"
          aria-expanded="false"
          data-index={index}
        >
          <span class="font-semibold text-lg text-gray-900 dark:text-white pr-8">{item.title}</span>
          <svg
            class="faq-icon w-5 h-5 text-gray-500 dark:text-gray-400 flex-shrink-0 transition-transform duration-200"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
          </svg>
        </button>
        <div class="faq-answer overflow-hidden transition-all duration-300 max-h-0">
          <div class="px-6 py-4 text-gray-600 dark:text-gray-300 border-t border-gray-200 dark:border-gray-700">
            {item.description}
          </div>
        </div>
      </div>
    ))}
  </div>
</WidgetWrapper>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const questions = document.querySelectorAll('.faq-question');

    questions.forEach((question) => {
      question.addEventListener('click', () => {
        const answer = question.nextElementSibling as HTMLElement;
        const icon = question.querySelector('.faq-icon') as HTMLElement;
        const isExpanded = question.getAttribute('aria-expanded') === 'true';

        // Close all other answers
        questions.forEach((q) => {
          if (q !== question) {
            const otherAnswer = q.nextElementSibling as HTMLElement;
            const otherIcon = q.querySelector('.faq-icon') as HTMLElement;
            q.setAttribute('aria-expanded', 'false');
            otherAnswer.style.maxHeight = '0';
            otherIcon.style.transform = 'rotate(0deg)';
          }
        });

        // Toggle current answer
        if (isExpanded) {
          question.setAttribute('aria-expanded', 'false');
          answer.style.maxHeight = '0';
          icon.style.transform = 'rotate(0deg)';
        } else {
          question.setAttribute('aria-expanded', 'true');
          answer.style.maxHeight = answer.scrollHeight + 'px';
          icon.style.transform = 'rotate(180deg)';
        }
      });
    });
  });
</script>
